import numpy as np
import pandas as pd
from PIL import Image
from StringIO import StringIO
import base64
import os
from sklearn.decomposition import RandomizedPCA
from sklearn.preprocessing import StandardScaler
from sklearn.svm import SVC
from sklearn.neighbors import KNeighborsClassifier
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import confusion_matrix
from sklearn.cross_validation import train_test_split

wd = "../numbers/"
files = [f for f in os.listdir(wd)]
files = [wd + f for f in files]

STANDARD_SIZE = (50, 50)
def get_image_data(filename):
    img = Image.open(filename)
    img = img.getdata()
    img = img.resize(STANDARD_SIZE)
    img = map(list, img)
    img = np.array(img)
    s = img.shape[0] * img.shape[1]
    img_wide = img.reshape(1, s)
    return img_wide[0]

data = []
labels = []
print "extracting features..."
for i, f in enumerate(files):
    print i, "of", len(files)
    data.append(get_image_data(f))
    labels.append(int(f.split(".")[-2][-1]))
print "done."

pca = RandomizedPCA(n_components=10)
std_scaler = StandardScaler()

X_train, X_test, y_train, y_test = train_test_split(data, labels, test_size=0.1)

print "scaling data..."
X_train = pca.fit_transform(X_train)
X_test = pca.transform(X_test)
print "done."

print "transforming data..."
X_train = std_scaler.fit_transform(X_train)
X_test = std_scaler.transform(X_test)
print "done."

print "training model..."
clf = KNeighborsClassifier(n_neighbors=33)
clf.fit(X_train, y_train)
print "done"
print "="*20
print clf

print "Confusion Matrix"
print "="*40
print confusion_matrix(y_test, clf.predict(X_test))


#from yhat import BaseModel, Yhat

#class DigitModel(BaseModel):

def require(self):
    from PIL import Image
    from StringIO import StringIO
    import base64


def transform(self):
    image_string = "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CBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0FMvW7gAAAExSURBVAMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFBA0AMxLUWAAAECBLIEBD1L3r4ECBAgQCBQQNADMS1FgAABAgSyBAQ9S96+BAgQIEAgUEDQAzEtRYAAAQIEsgQEPUvevgQIECBAIFDg/wDHTL3Kv+Qp6wAAAABJRU5ErkJggg==
"
    STANDARD_SIZE = (50, 50)
    f = StringIO(base64.decodestring(image_string))
    img = Image.open(f)
    img = img.getdata()
    img = img.resize(STANDARD_SIZE)
    img = map(list, img)
    img = np.array(img)
    s = img.shape[0] * img.shape[1]
    img_wide = img.reshape(1, s)
    return img_wide[0]


def predict(self, img):
    x = self.pca.transform([img])
    x = self.std_scaler.transform(x)
    results = {"label": self.clf.predict(x)[0]}
    probs = {"prob_" + str(i) : prob for i, prob in enumerate(self.clf.predict_proba(x)[0])}
    results['probs'] = probs
    return results

if __name__ == '__main__':
   image_string = sys.argv[1]
   transform()

#digit_model = DigitModel(clf=clf, std_scaler=std_scaler, pca=pca)

#yh = Yhat("greg", "abcd1234", "http://starphleet-aa02a554-1981699582.us-west-1.elb.amazonaws.com/deployer/")
#yh.deploy("digitRecognizer", digit_model) 



